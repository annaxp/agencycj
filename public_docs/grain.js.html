<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: grain.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: grain.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>export default class Grain {
  constructor(el, { color, alpha } = { color: '', alpha: 15 }) {
    /**
     * Options
     * Increase the pattern size if visible pattern
     */
    this.patternSize = 100
    this.patternScaleX = 1
    this.patternScaleY = 1
    this.patternRefreshInterval = 3 // 8
    this.patternAlpha = alpha // int between 0 and 255,

    /**
     * Create canvas
     */
    this.canvas = el
    this.ctx = this.canvas.getContext('2d')
    this.ctx.scale(this.patternScaleX, this.patternScaleY)

    /**
     * Create a canvas that will be used to generate grain and used as a
     * pattern on the main canvas.
     */
    this.patternCanvas = document.createElement('canvas')
    this.patternCanvas.width = this.patternSize
    this.patternCanvas.height = this.patternSize
    this.patternCtx = this.patternCanvas.getContext('2d')
    this.patternData = this.patternCtx.createImageData(
      this.patternSize,
      this.patternSize,
    )
    this.patternPixelDataLength = this.patternSize * this.patternSize * 4 // rgba = 4

    /**
     * Prebind prototype function, so later its easier to user
     */
    this.resize = this.resize.bind(this)
    this.loop = this.loop.bind(this)

    this.frame = 0

    window.addEventListener('resize', this.resize)
    this.resize()

    window.requestAnimationFrame(this.loop)
  }

  resize() {
    this.canvas.width = window.innerWidth
    this.canvas.height = window.innerHeight
  }

  update() {
    const { patternPixelDataLength, patternData, patternAlpha, patternCtx } =
      this

    // put a random shade of gray into every pixel of the pattern
    for (let i = 0; i &lt; patternPixelDataLength; i += 4) {
      // const value = (Math.random() * 255) | 0;
      const value = Math.random() * 255

      patternData.data[i] = value
      patternData.data[i + 1] = value
      patternData.data[i + 2] = value
      patternData.data[i + 3] = patternAlpha
    }

    patternCtx.putImageData(patternData, 0, 0)
  }

  draw() {
    const { ctx, patternCanvas, canvas } = this
    const { width, height } = canvas

    // clear canvas
    ctx.clearRect(0, 0, width, height)

    // fill the canvas using the pattern
    ctx.fillStyle = ctx.createPattern(patternCanvas, 'repeat')
    ctx.fillRect(0, 0, width, height)
  }

  loop() {
    // only update grain every n frames
    const shouldDraw = ++this.frame % this.patternRefreshInterval === 0
    if (shouldDraw) {
      this.update()
      this.draw()
    }

    window.requestAnimationFrame(this.loop)
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-data.html">Данные</a></li></ul><h3>Global</h3><ul><li><a href="global.html#deepExtend">deepExtend</a></li><li><a href="global.html#getAverage">getAverage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Nov 20 2021 12:55:06 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
